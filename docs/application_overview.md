# アプリケーション機能概要

## システム概要

このシステムは、Next.jsとPrismaを使用した管理者向けのログイン・認証システムです。ユーザーは権限に基づいて様々なアプリケーションにアクセスできるポータルサイトとなっています。

## 主要機能

### 1. ユーザー認証

- **ログイン機能**
  - メールアドレスとパスワードによる認証
  - JWT（JSON Web Token）を使用したセッション管理
  - ログイン情報の保存機能（オプション）

- **ログアウト機能**
  - セッションの破棄
  - ログインページへのリダイレクト

- **パスワード変更機能**
  - 現在のパスワード確認
  - 新しいパスワードの設定
  - パスワードのハッシュ化（bcrypt）

### 2. ロールベースのアクセス制御（RBAC）

- **権限管理**
  - 細かい粒度の権限設定
  - ロールごとの権限割り当て
  - 権限に基づいたUI要素の表示/非表示

- **デフォルトロール**
  - admin（管理者）: すべての権限
  - user（一般ユーザー）: 閲覧権限のみ
  - viewer（閲覧者）: 閲覧権限のみ

### 3. ユーザー管理

- **ユーザー一覧表示**
  - ユーザー情報の一覧表示
  - ソート・フィルタリング機能

- **ユーザー作成**
  - 基本情報（名前、メールアドレス）の登録
  - パスワード設定
  - ロール割り当て

- **ユーザー編集**
  - 基本情報の更新
  - ロールの変更

- **ユーザー削除**
  - ユーザーアカウントの削除

### 4. ロール管理

- **ロール一覧表示**
  - ロール情報の一覧表示
  - 各ロールに割り当てられた権限の表示

- **ロール作成**
  - ロール名と説明の設定
  - 権限の割り当て

- **ロール編集**
  - ロール情報の更新
  - 権限の追加/削除

- **ロール削除**
  - 未使用ロールの削除

### 5. アプリケーションポータル

- **アプリケーション一覧表示**
  - 権限に基づいたアプリケーション表示
  - アプリケーション情報（名前、説明、アイコン）の表示
  - カテゴリとタグによる分類

- **アプリケーションアクセス**
  - アプリケーションの起動
  - 権限チェック
  - アプリケーション間のナビゲーション

- **戻るボタン制御**
  - アプリケーションごとに戻るボタン操作の許可/禁止を設定
  - ブラウザの戻るボタン、キーボードショートカットの制御
  - 共通レイアウトでの一元管理
  - 各ページでの状態表示とユーザーへのフィードバック
  - ダッシュボードへの安全な遷移処理

## 画面構成

### 1. ログイン画面
- メールアドレス入力フィールド
- パスワード入力フィールド
- ログイン情報を保存するチェックボックス
- ログインボタン
- エラーメッセージ表示領域

### 2. ダッシュボード画面
- ユーザー情報表示
- アクセス可能なアプリケーション一覧
- ナビゲーションメニュー

### 3. ユーザー管理画面
- ユーザー一覧テーブル
- ユーザー作成ボタン
- ユーザー編集/削除ボタン
- ユーザー詳細モーダル/ページ

### 4. ロール管理画面
- ロール一覧テーブル
- ロール作成ボタン
- ロール編集/削除ボタン
- ロール詳細モーダル/ページ

### 5. アカウント設定画面
- ユーザープロフィール情報
- パスワード変更フォーム

## 技術的特徴

### 1. モダンなフロントエンド
- Next.js App Routerを使用したルーティング
- Reactコンポーネントによる再利用可能なUI
- TypeScriptによる型安全な開発
- Tailwind CSSによるスタイリング
- shadcn/uiによるUIコンポーネント
- Framer Motionによるアニメーション効果
- 共通レイアウトを活用した機能の一元管理

### 2. セキュアなバックエンド
- Next.js API Routesによるサーバーサイド処理
- NextAuthによる認証システム
- JWTを使用したセッション管理
- bcryptによるパスワードハッシュ化
- 権限チェックによるセキュリティ強化
- ブラウザ操作の制御によるセキュリティ向上

### 3. 堅牢なデータ管理
- Prisma ORMによるデータベース操作
- PostgreSQLデータベース
- マイグレーションによるスキーマ管理
- シードデータによる初期データ設定

## システムフロー

1. **ユーザーログイン**
   - ユーザーがログインページにアクセス
   - メールアドレスとパスワードを入力
   - 認証成功時、JWTトークンが発行され、ダッシュボードにリダイレクト
   - 認証失敗時、エラーメッセージを表示

2. **ダッシュボード表示**
   - ユーザー情報の表示
   - 権限に基づいたアプリケーション一覧の表示
   - ナビゲーションメニューの表示（権限に基づく）

3. **アプリケーションアクセス**
   - ユーザーがアプリケーションを選択
   - 権限チェック
   - 権限がある場合、アプリケーションページに遷移
   - アプリケーション設定に基づいて戻るボタン制御を適用
   - 権限がない場合、エラーメッセージを表示

4. **アプリケーション内操作**
   - アプリケーション機能の利用
   - 戻るボタンが禁止されている場合、ブラウザの戻るボタンやキーボードショートカットが無効化
   - ダッシュボードに戻る場合は専用ボタンを使用

5. **ユーザー管理**
   - 管理者がユーザー一覧を表示
   - ユーザーの作成、編集、削除が可能
   - パスワードリセット機能

6. **ロール管理**
   - 管理者がロール一覧を表示
   - ロールの作成、編集、削除が可能
   - 権限の割り当て/解除が可能

## 拡張性

このシステムは以下の点で拡張性を持っています：

1. **新規アプリケーションの追加**
   - アプリケーション定義を追加するだけで新しいアプリケーションを統合可能
   - 権限設定による柔軟なアクセス制御
   - 戻るボタン制御の設定も簡単に追加可能

2. **権限の拡張**
   - 新しい権限タイプの追加が容易
   - 既存のロールに新しい権限を割り当て可能

3. **UIのカスタマイズ**
   - コンポーネントベースの設計によるUI変更の容易さ
   - テーマ設定によるスタイルのカスタマイズ
   - 共通レイアウトによる機能の一元管理

4. **認証方法の拡張**
   - NextAuthの柔軟性を活かした追加認証プロバイダーの統合
   - ソーシャルログインの追加など

5. **セキュリティ機能の拡張**
   - 戻るボタン制御のような特殊な要件にも対応可能
   - アプリケーションごとのセキュリティ設定のカスタマイズ 